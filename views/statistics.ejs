<!-- 
    The statistics.ejs file displays data obtained through
    three complex queries that are implemented in the
    database. The data includes certain patient groups,
    the most commonly used treatments at the hospital, and 
    statistics about the medical staff (the providers).
    All of this information is obtained through the use
    of complex queries.
    ...
    Project: Mayo Clinic Patient Care Manager 
             (PCM) Web Application
    Author: Andrew Krause
    Class: Introduction to Database 
           Management Systems (CS 364)
    Date: 5/10/2022
    ...
-->

<%- include('./partials/header.ejs') %>

    <!-- Section for the list of different statistics on the webpage -->
    <section id="statistics-page">
        <div class="fade-in">
            <header>
                <h1 class="statistic-page-text">Statistics</h1>
            </header>
            <div class="statistic-ordering">
                <!-- Create an anchor tag to process when the user clicks the "Back" button -->
                <div class="statistic-buttons">
                    <a id="statistic-back-arrow" class="all-button-container-one" style="border-top-right-radius: 10px; border-bottom-right-radius: 10px;" href="/views">
                        <span class="statistic-button-icon"><i class="fa-solid fa-arrow-left-long"></i></span> Back
                    </a>
                </div>

                <!-- 
                    This is the section where the statistics
                    are loaded to be displayed on the page
                -->
                <div class="statistic-items">
                    
                    <!-- LEFT OFF HERE; WILL NEED TO FIX THE POSITION OF THE BACK BUTTON BEING DISPLAYED!!! -->

                    <!-- 
                        Include a function to simplify any dates that may be displayed
                        in the data existent on this page of the web application
                     -->
                    <% function simplifyDate(birthDate) { %>

                        <% // First split the event into the components that directly %>
                        <% // involve the numberical representations of a date. %>
                        <% var date = birthDate.toISOString().split("T")[0]; %>
                    
                        <% // Create variables for workring with %>
                        <% // the nubmers in the date variable. %>
                        <% var arrayDate = date.split('-'); %>
                        <% var day = arrayDate[2]; %>
                        <% var getMonth = arrayDate[1]; %>
                        <% var month = ""; %>
                        <% var year = arrayDate[0]; %>
                        <% var simplifiedDate = ""; %>
                    
                        <% // Use a series of conditionals to determine %>
                        <% // what the name of the month is based on the %>
                        <% // numerical representation of it. %>
                        <% if(getMonth.localeCompare('01') == 0) { %>
                            <% month = 'Jan'; %>
                        <% } else if(getMonth.localeCompare('02') == 0) { %>
                            <% month = 'Feb'; %>
                        <% } else if(getMonth.localeCompare('03') == 0) { %>
                            <% month = 'Mar'; %>
                        <% } else if(getMonth.localeCompare('04') == 0) { %>
                            <% month = 'Apr'; %>
                        <% } else if(getMonth.localeCompare('05') == 0) { %>
                            <% month = 'May'; %>
                        <% } else if(getMonth.localeCompare('06') == 0) { %>
                            <% month = 'Jun'; %>
                        <% } else if(getMonth.localeCompare('07') == 0) { %>
                            <% month = 'Jul'; %>
                        <% } else if(getMonth.localeCompare('08') == 0) { %>
                            <% month = 'Aug'; %>
                        <% } else if(getMonth.localeCompare('09') == 0) { %>
                            <% month = 'Sep'; %>
                        <% } else if(getMonth.localeCompare('10') == 0) { %>
                            <% month = 'Oct'; %>
                        <% } else if(getMonth.localeCompare('11') == 0) { %>
                            <% month = 'Nov'; %>
                        <% } else if(getMonth.localeCompare('12') == 0) { %>
                            <% month = 'Dec'; %>
                        <% } else { %>
                            <% month = 'ERROR'; %>
                        <% } %>
                    
                        <% // Create the simplified date and return it. %>
                        <% simplifiedDate = month + " " + day + ", " + year; %>
                        <% return simplifiedDate; %>
                    <% } %>
                    
                    <!-- 
                        If there is data that resulted from any of 
                        the complex queries for the hospital statistics,
                        display that data below.
                    -->
                    <% if(highestRiskPatient.length != 0 || numberOfCareProviders.length != 0 || treatmentsAdministered != 0) { %>

                        <!-- ================================================================================== -->
                                        <!-- DATA FOR COMPLEX QUERY 1: Top 5 Highest Risk Patients -->
                        <!-- ================================================================================== -->

                        <!--
                            Create a div to hold the button collapse function layout. 
                            The main components within this div include the main button
                            and the content that appears when the user clicks the button.
                        -->
                        <div>

                            <!-- Create a card for the statistic -->
                            <!-- First, create a heading that displays the name of the statistic -->
                            <div class="statistic-name">

                                <!-- 
                                    Display the statistic name and text
                                -->
                                <h2 class="statistic-name-text">

                                    <!-- Include a div to show the statistic name and action buttons -->
                                    <div class="statistic-name-and-buttons" style="display: flex; flex-direction: row;">

                                        <!-- 
                                            Display an icon for the statistic
                                        -->
                                        <div class="statistic-full-name">
                                            <!-- 
                                                Display the icon for the patients a high risk index.
                                            -->
                                            <i class="fa-solid fa-heart-circle-exclamation"></i>
                                            High-Risk Patients
                                        </div>

                                        <!-- Include action button here -->
                                        <div class="statistic-edit-remove-buttons">
                                            
                                            <!-- 
                                                Include a button for expanding any statistics's information.
                                                This button is used to expand any statistic module that is
                                                listed in the database.
                                            -->
                                            <a class="statistic-edit-white statistic-edit-remove" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-statistics1" aria-expanded="false" aria-controls="collapse-statistics1">
                                                <i class="fa-solid fa-circle-info"></i>
                                            </a>
                                        </div>
                                    </div>
                                </h2>
                            </div>

                            <!-- Create the main-content portion of the statistic card -->
                            <div id="collapse-statistics1" class="collapse">
                                
                                <!-- 
                                    Include a wrapper div for the collapse div. This helps 
                                    ensure that the transition from closed to open is smooth.
                                -->
                                <div class="statistic-card">

                                     <!-- Include a heading that explains the data that is being displayed -->
                                     <h2 class="no-statistic-data" style="margin-top: 0;">Top 5 patients who have a risk index greater than or equal to 6.</h2>

                                    <!-- 
                                        If there is data that resulted from the first
                                        complex query, then display that data
                                    -->
                                    <% if(highestRiskPatient.length != 0) { %>

                                        <!-- 
                                            Loop through all of the high risk patients in 
                                            the database and display them on the page 
                                        -->
                                        <% highestRiskPatient.forEach(function(data) { %>

                                            <!-- 
                                                If the patient is currently in care at the hospital, then
                                                display their data within the statistics card.
                                            -->
                                            <% if(data.PatientEndDate == null) { %>

                                                <!-- Each column of the card displays different amounts of data -->
                                                <div class="statistic-column">
                                                    <p class="statistic-text-info"><b><%= data.PatientFirstName %> <%= data.PatientMiddleName %> <%= data.PatientLastName %></p></b>
                                                    <p class="statistic-text-info">Patient has a risk index of <%= data.PatientRiskIndex %>.</p>
                                                    <p class="statistic-text-info"><%= data.PatientNotes %></p>
                                                </div>

                                            <!-- 
                                                If there is no data that resulted from the
                                                complex query, then display the message below.
                                            -->
                                            <% } else { %>
                                                <h2 class="no-statistic-data">There are currently no high-risk patients.</h2>
                                            <% } %>

                                        <% }); %>

                                    <!-- 
                                        If there is no data for the query that 
                                        was executed, display the message
                                    -->
                                    <% } else { %>
                                        <h2 class="no-statistic-data">There are currently no high-risk patients.</h2>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- ================================================================================== -->
                                <!-- DATA FOR COMPLEX QUERY 2: Providers Caring for 5 or More Patients -->
                        <!-- ================================================================================== -->

                        <!--
                            Create a div to hold the button collapse function layout. 
                            The main components within this div include the main button
                            and the content that appears when the user clicks the button.
                        -->
                        <div>

                            <!-- Create a card for the statistic -->
                            <!-- First, create a heading that displays the name of the statistic -->
                            <div class="statistic-name">

                                <!-- 
                                    Display the statistic name and text
                                -->
                                <h2 class="statistic-name-text">

                                    <!-- Include a div to show the statistic name and action buttons -->
                                    <div class="statistic-name-and-buttons" style="display: flex; flex-direction: row;">

                                        <!-- 
                                            Display an icon for the statistic
                                        -->
                                        <div class="statistic-full-name">
                                            <!-- 
                                                Display the icon for the providers   
                                                caring for 5 or more patients.
                                            -->
                                            <i class="fa-solid fa-star-of-life"></i>
                                            Providers Caring for 5 or More Patients
                                        </div>

                                        <!-- Include action button here -->
                                        <div class="statistic-edit-remove-buttons">
                                            
                                            <!-- 
                                                Include a button for expanding any statistics's information.
                                                This button is used to expand any statistic module that is
                                                listed in the database.
                                            -->
                                            <a class="statistic-edit-white statistic-edit-remove" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-statistics2" aria-expanded="false" aria-controls="collapse-statistics2">
                                                <i class="fa-solid fa-circle-info"></i>
                                            </a>
                                        </div>
                                    </div>
                                </h2>
                            </div>

                            <!-- Create the main-content portion of the statistic card -->
                            <div id="collapse-statistics2" class="collapse">
                                
                                <!-- 
                                    Include a wrapper div for the collapse div. This helps 
                                    ensure that the transition from closed to open is smooth.
                                -->
                                <div class="statistic-card">

                                     <!-- Include a heading that explains the data that is being displayed -->
                                     <h2 class="no-statistic-data" style="margin-top: 0;">Providers that are caring for 5 or more patients.</h2>

                                    <!-- 
                                        If there is data that resulted from the first
                                        complex query, then display that data
                                    -->
                                    <% if(numberOfCareProviders.length != 0) { %>

                                        <!-- 
                                            Loop through all of the high risk patients in 
                                            the database and display them on the page 
                                        -->
                                        <% numberOfCareProviders.forEach(function(data) { %>

                                            <!-- 
                                                If the patient is currently in care at the hospital, then
                                                display their data within the statistics card.
                                            -->
                                            <% if(data.PatientEndDate == null) { %>

                                                <!-- Each column of the card displays different amounts of data -->
                                                <div class="statistic-column">
                                                    <p class="statistic-text-info"><b><%= data.ProviderFirstName %> <%= data.ProviderLastName %>, <%= data.ProviderTitle %></p></b>
                                                    <p class="statistic-text-info">Provider is caring for <%= data.NumPatients %> patients.</p>
                                                </div>

                                            <!-- 
                                                If there is no data that resulted from the
                                                complex query, then display the message below.
                                            -->
                                            <% } else { %>
                                                <h2 class="no-statistic-data">There are currently no providers treating 5 or more patients.</h2>
                                            <% } %>

                                        <% }); %>

                                    <!-- 
                                        If there is no data for the query that 
                                        was executed, display the message
                                    -->
                                    <% } else { %>
                                        <h2 class="no-statistic-data">There are currently no providers treating 5 or more patients.</h2>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- ================================================================================== -->
                        <!-- DATA FOR COMPLEX QUERY 3: Which Providers Administer High-Risk Treatments -->
                        <!-- ================================================================================== -->

                        <!--
                            Create a div to hold the button collapse function layout. 
                            The main components within this div include the main button
                            and the content that appears when the user clicks the button.
                        -->
                        <div>

                            <!-- Create a card for the statistic -->
                            <!-- First, create a heading that displays the name of the statistic -->
                            <div class="statistic-name">

                                <!-- 
                                    Display the statistic name and text
                                -->
                                <h2 class="statistic-name-text">

                                    <!-- Include a div to show the statistic name and action buttons -->
                                    <div class="statistic-name-and-buttons" style="display: flex; flex-direction: row;">

                                        <!-- 
                                            Display an icon for the statistic
                                        -->
                                        <div class="statistic-full-name">
                                            <!-- 
                                                Display the icon for the providers   
                                                that administered treatments 5 or
                                                more times.
                                            -->
                                            <i class="fa-solid fa-flask-vial"></i>
                                            Providers and High-Risk Treatments
                                        </div>

                                        <!-- Include action button here -->
                                        <div class="statistic-edit-remove-buttons">
                                            
                                            <!-- 
                                                Include a button for expanding any statistics's information.
                                                This button is used to expand any statistic module that is
                                                listed in the database.
                                            -->
                                            <a class="statistic-edit-white statistic-edit-remove" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-statistics3" aria-expanded="false" aria-controls="collapse-statistics3">
                                                <i class="fa-solid fa-circle-info"></i>
                                            </a>
                                        </div>
                                    </div>
                                </h2>
                            </div>

                            <!-- Create the main-content portion of the statistic card -->
                            <div id="collapse-statistics3" class="collapse">
                                
                                <!-- 
                                    Include a wrapper div for the collapse div. This helps 
                                    ensure that the transition from closed to open is smooth.
                                -->
                                <div class="statistic-card">

                                    <!-- Include a heading that explains the data that is being displayed -->
                                    <h2 class="no-statistic-data" style="margin-top: 0;">Providers that administer high-risk treatments.</h2>

                                    <!-- 
                                        If there is data that resulted from the first
                                        complex query, then display that data
                                    -->
                                    <% if(treatmentsAdministered.length != 0) { %>

                                        <!-- <h2 class="no-statistic-data">Providers that administered treatments 5 or more times are listed here.</h2> -->

                                        <!-- 
                                            Loop through all of the high risk patients in 
                                            the database and display them on the page 
                                        -->
                                        <% treatmentsAdministered.forEach(function(data) { %>

                                            <!-- 
                                                If the patient is currently in care at the hospital, then
                                                display their data within the statistics card.
                                            -->
                                            <% if(data.PatientEndDate == null) { %>

                                                <!-- Each column of the card displays different amounts of data -->
                                                <div class="statistic-column">
                                                    <p class="statistic-text-info"><b><%= data.ProviderFirstName %> <%= data.ProviderLastName %>, <%= data.ProviderTitle %></p></b>
                                                    <p class="statistic-text-info">Provider administers <%= data.TreatmentName %>.</p>
                                                </div>

                                            <!-- 
                                                If there is no data that resulted from the
                                                complex query, then display the message below.
                                            -->
                                            <% } else { %>
                                                <h2 class="no-statistic-data">There are currently no providers that administered high-risk treatments.</h2>
                                            <% } %>

                                        <% }); %>

                                    <!-- 
                                        If there is no data for the query that 
                                        was executed, display the message
                                    -->
                                    <% } else { %>
                                        <h2 class="no-statistic-data">There are currently no providers that administered high-risk treatments.</h2>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- ================================================================================== -->

                    <!-- 
                        If there is no data for the query that 
                        was executed, display the message
                     -->
                    <% } else { %>
                        <h2 class="no-statistic-data">There is currently no data.</h2>
                    <% } %>
                </div>
            </div>

            <!-- 
                Include a div that displays a chevron that the
                user can click to return to the top of the page
            -->
            <div>
                <!-- Include a button for the user to click to go to the top of the page -->
                <a class="statistic-bottom statistic-bottom-color" href="#statistics-page">
                    <i class="fa-solid fa-chevron-up fa-1.5x"></i>
                </a>
            </div>
        </div>
    </section>

<%- include('./partials/footer.ejs') %>